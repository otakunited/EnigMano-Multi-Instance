name: "‚ö° EnigMano Win11 + Chrome Remote Desktop"

on:
  workflow_dispatch:

jobs:
  deploy-enigmano:
    runs-on: windows-latest

    steps:
      - name: üåê Install Google Chrome
        shell: pwsh
        run: |
          $chromeInstaller = "$env:TEMP\chrome_installer.exe"
          Invoke-WebRequest "https://dl.google.com/chrome/install/latest/chrome_installer.exe" -OutFile $chromeInstaller
          Start-Process $chromeInstaller -ArgumentList "/silent /install" -Wait

      - name: üåê Install Chrome Remote Desktop Host
        shell: pwsh
        run: |
          $crdInstaller = "$env:TEMP\crdhost.msi"
          Invoke-WebRequest "https://dl.google.com/dl/chrome-remote-desktop/chrome_remote_desktop.msi" -OutFile $crdInstaller
          Start-Process msiexec.exe -ArgumentList "/i `"$crdInstaller`" /qn" -Wait

      - name: ‚öôÔ∏è Configure Chrome Remote Desktop
        shell: pwsh
        run: |
          $exe = "${Env:ProgramFiles(x86)}\Google\Chrome Remote Desktop\CurrentVersion\remoting_start_host.exe"
          if (-not (Test-Path $exe)) {
            Write-Error "‚ùå CRD executable not found at $exe"
            exit 1
          }

          & "$exe" `
            --code="4/0AVMBsJhIqShthYalxeb90iucACB0oQxiWKlYOh5aYgT1701tiAriiPjIbwH1l5Y9l8e-wA" `
            --redirect-url="https://remotedesktop.google.com/_/oauthredirect" `
            --name="EnigMano-Win11" `
            --pin=123456

          Write-Host "‚úÖ CRD host registered. PIN: 123456"

      - name: ‚ôæÔ∏è Keep session alive
        shell: pwsh
        run: |
          Write-Host "Keeping instance alive for 6 hours..."
          Start-Sleep -Seconds 21600
